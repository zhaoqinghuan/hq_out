window.FrontJS=function(e,r,t){"use strict";var n="https://collecter.frontjs.com/",o="https://static.frontjs.com/dist/current/tracker.min.js",a="1.0.0-rc.20",i=5e3,s=0,c=1,u=2,l=4,m=8,f=256,p=512,g=513,d=514,v=515,h=768,y=769,D=770,_=771,S=772,E=1024,k=["www.google-analytics.com","www.googletagmanager.com","retcode.alicdn.com","arms-retcode.aliyuncs.com","hm.baidu.com","zz.bdstatic.com"],R=function(e,r){r=r||"";var t={1001:"Invalid token",1002:"Invalid behaviour settings",1003:"Invalid origin settings",1004:"Invalid exclude settings",1005:"Invalid user data",1006:"Invalid history API type",1007:"Invalid route mapping settings",4000:"Bad configuration! Fail to start!",4001:"FrontJS is already defined, Fail to start!"};t[e]&&console.warn(["Error(frontjs):",t[e],"(CODE"+e+")","See https://www.frontjs.com/doc/view/errcode/#"+encodeURIComponent(r)].join(" "))};if(e.FrontJS&&e.FrontJS.V)return R(4001),e.FrontJS;var T=function(e){return e&&e.match(/^\w{32}$/)?0:1},C=function(e){return e<=(c|u|l|m)?0:1},L=function(e){e=e||[];for(var r=0;r<e.length;r++)if("string"==typeof e[r]);else if(!e[r].test)return e[r];return 0},w=function(e){e=e||[];for(var r=0;r<e.length;r++)if("string"!=typeof e[r][0]||"string"!=typeof e[r][1])return"Pair: "+e[r].join(",");return 0},I=function(e){for(var r in e=e||{})if("object"==typeof e[r]||"string"!=typeof r)return r;return 0},b={parseRegExp:function(e){if("string"==typeof e&&e.match(/^\/(.*)\/(i|g|m|u|y)*$/))try{return new Function("return "+e)()}catch(e){}return null},KVArrayCopy:function(e){var r={};for(var t in e)r[t]=e[t];return r},uriArrayCopy:function(e){e=e||[];for(var r=[],t=0;t<e.length;t++)"string"==typeof e[t]&&(b.parseRegExp(e[t])?r.push(b.parseRegExp(e[t])):r.push(e[t]));return r},routeArrayCopy:function(e){e=e||[];for(var r=[],t=0;t<e.length;t++)"string"==typeof e[t][0]&&(b.parseRegExp(e[t][0])?r.push([b.parseRegExp(e[t][0]),e[t][1]]):r.push([e[t][0],e[t][1]]));return r},getTime:function(){return(new Date).getTime()},getGUID:function(e){var r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],t=(e||b.getTime()).toString(16);for(t="0"+t;t.length<16;)t="f"+t;for(;t.length<32;)t+=r[Math.floor(16*Math.random())];return t},stringifyParameter:function(e){var r=[];if(e&&e.length){for(var t=0;t<e.length;t++)if(null===e[t])r.push("null");else if(void 0===e[t])r.push("undefined");else if(e[t]instanceof Array&&"string"==typeof e[t].toString())r.push("["+e[t].toString()+"]");else if("object"==typeof e[t]){var n=[];for(var o in e[t]){var a="";if(a+=o+": ",null===e[t][o])a+="null";else if(void 0===e[t][o])a+="undefined";else{switch(typeof e[t][o]){case"object":e[t][o]instanceof Array&&"string"==typeof e[t][o].toString()?a+="["+e[t][o].toString()+"]":"string"==typeof e[t][o].valueOf()?a+=e[t][o].toString():"string"==typeof e[t][o].toString()?a+=e[t][o].toString():a+="[object]";break;case"function":a+="[function]";break;default:a+=e[t][o].toString()}}n.push(a)}r.push("{"+n.join(", ")+"}")}else"string"==typeof e[t].valueOf()?r.push(e[t].valueOf()):"string"==typeof e[t].toString()?r.push(e[t].toString()):r.push("[object]");return r.join(", ")}return"[object]"},addSlashes:function(e){return e.replace(/(\.|\\|\/|\||\+|\$|\^)/g,"\\$1")},filterTrace:function(e){var r=new RegExp("((?!\n).)*"+b.addSlashes(o)+".*\n","g");return e.replace(r,"")},getUserAgent:function(){return e.navigator.userAgent},getCurrentURL:function(){return $.length<1?e.location.href:$[$.length-1]},getRefererURL:function(){return $.length<2?r.referrer:$[$.length-2]},getRoute:function(e,r){if(r)for(var t=0;t<r.length;t++){var n=e.match(r[t][0]);if(n)return r[t][1].replace(/\$(\d+)/g,function(){return n[arguments[1]]||"$"+arguments[1]})}return e},getViewPortSize:function(){return{w:e.innerWidth,h:e.innerHeight,r:e.devicePixelRatio}},getClientID:function(){return e.localStorage?(e.localStorage.getItem("frontjs:client:id")||e.localStorage.setItem("frontjs:client:id",b.getGUID()),e.localStorage.getItem("frontjs:client:id")):b.getGUID()},getSessionID:function(){return e.sessionStorage?(e.sessionStorage.getItem("frontjs:session:id")||e.sessionStorage.setItem("frontjs:session:id",b.getGUID()),e.sessionStorage.getItem("frontjs:session:id")):b.getGUID()},checkCrossOrigin:function(e,r){if(r){e=e||"";for(var t=!1,n=0;n<r.length;n++)""!==r[n]&&e.match(r[n])&&(t|=!0);return!t}return!1},checkInBaseDomain:function(r){var t=(e.location.origin||e.location.host).replace(/^http(s):\/\//,"").replace(/:(\d+)/,"").split(".").slice(-2).join(".");return r.toLowerCase().indexOf(t)>-1},checkTimingSlow:function(e,r){return!!r&&(e.send>r.sned&&r.sned>0||e.load>r.load&&r.load>0||e.total>r.total&&r.total>0)},calculateTrackerTiming:function(e){if(e._time_done&&e._time_load&&e._time_send&&e._time_done){var r=e._time_send-e._time_open,t=e._time_load-e._time_send,n=e._time_done-e._time_open;return{send:r=r<0?null:r,load:t=t<0?null:t,total:n=n<0?null:n}}return{send:0,load:0,total:0}},getResourceTimingData:function(r){var t=e.performance&&e.performance.getEntriesByType&&e.performance.getEntriesByType("resource");if(!t)return null;for(var n=t.length-1;n>=s;n--)if(r.length&&t[n].name.length&&t[n].name.substring(t[n].name.length-r.length)===r)return b.getTimingData(t[n]);return null},getTimingData:function(e){var r={};return r.dns=e.domainLookupEnd-e.domainLookupStart,r.connect=e.connectEnd-e.connectStart,r.request=e.responseStart-e.requestStart,r.response=e.responseEnd-e.responseStart,r.dns>=0&&r.connect>=0&&r.request>=0&&r.response>=0?r:null},composeTrackerData:function(e,r){return{type:e,data:r}},composeScriptErrorData:function(e,r,t,n,o,a){return a=a&&a.stack?a.stack.toString():"",{message:e,detail:{err:r,file:t,line:n,column:o,trace:a=b.filterTrace(a)}}},composeXHRErrorData:function(e,r,t,n){return{message:e,detail:{requestURL:r,responseData:t,timing:n}}},composeResourceErrorData:function(e,r,t){return{message:e,detail:{tagname:r,resourceURL:t}}},composePerformaceData:function(e,r){return{message:e,detail:r}}},U=function(r){var t={},a=!0;if(T(r.token)?(R(1001),a&=!1):t.token=r.token.toString(),C(r.behaviour)?(R(1002),a&=!1):(t.behaviour=parseInt(r.behaviour),t.behaviour||(t.behaviour=c|u|l|m)),L(r.origin)){var i=L(r.behaviour);R(1003,i),a&=!1}else t.origin=b.uriArrayCopy(r.origin),t.origin.push(e.location.origin||e.location.host),t.origin.push(/^((?!:\/\/).)*$/),t.origin.push(o),t.origin.push(n);return L(r.exclude)?(i=L(r.exclude),R(1004,i),a&=!1):(t.exclude=b.uriArrayCopy(r.exclude),t.exclude.push(o),t.exclude.push(n)),I(r.userData)?(i=I(r.userData),R(1005,i),a&=!1):t.userData=b.KVArrayCopy(r.userData),r.optimisedForSPA?(t.optimisedForSPA=!!r.optimisedForSPA,t.useHistory=!!r.useHistory):(t.optimisedForSPA=!1,t.useHistory=!1),r.trustVendor&&(t.origin=t.origin.concat?t.origin.concat(k):t.origin),r.ignoreVendor&&(t.exclude=t.exclude.concat?t.exclude.concat(k):t.exclude),w(r.routeMapping)?(i=w(r.routeMapping),R(1007,i),a&=!1):t.routeMapping=b.routeArrayCopy(r.routeMapping),!!a&&t}(t);if(!U)return R(4e3),!1;var q=e.XMLHttpRequest;if(e.XMLHttpRequest=function(){var e=new q;return e._tracker_open=e.open,e.tracker={_time_init:0,_time_open:0,_time_send:0,_time_load:0,_time_done:0,_request_method:"",_request_url:"",_status:""},e.addEventListener("error",X),e.addEventListener("timeout",X),e.addEventListener("readystatechange",X),e.open=function(r,t,n,o,a){return e.tracker._request_method=r,e.tracker._request_url=t,e.tracker._time_open=b.getTime(),e._tracker_open(r,t,!1!==n,o,a)},e},e.console){var j=e.console.log,x=e.console.warn,P=e.console.error;e.console.log=function(){var r=[].slice.call(arguments);if(!r.length)return!0;var t=b.composeScriptErrorData(257,b.stringifyParameter(r).substr(0,1e3),"via console.log",0,0,new Error(b.stringifyParameter(r).substr(0,1e3))),n=t.detail.trace.split("\n");U.behaviour&c&&(b.checkInBaseDomain(n.shift())||b.checkInBaseDomain(n.shift()))&&N(f,t),j.apply(e.console,r)},e.console.warn=function(){var r=[].slice.call(arguments);if(!r.length)return!0;var t=b.composeScriptErrorData(258,b.stringifyParameter(r).substr(0,1e3),"via console.warn",0,0,new Error(b.stringifyParameter(r).substr(0,1e3)));U.behaviour&c&&N(f,t),x.apply(e.console,r)},e.console.error=function(){var r=[].slice.call(arguments);if(!r.length)return!0;var t=b.composeScriptErrorData(259,b.stringifyParameter(r).substr(0,1e3),"via console.error",0,0,new Error(b.stringifyParameter(r).substr(0,1e3)));U.behaviour&c&&N(f,t),P.apply(e.console,r)}}if(e.fetch){var O=e.fetch;e.fetch=function(){var r=[].slice.call(arguments),t=b.getTime(),n=O.apply(e,r);return n.then(function(e){if(b.checkCrossOrigin(r[0],U.exclude)&&U.behaviour&l){var n=b.getTime()-t,o=b.getResourceTimingData(r[0]);if(b.checkCrossOrigin(r[0],U.origin)){var a=b.composeXHRErrorData(S,r[0],{status:e.status},{send:n,load:null,total:n});N(h,a,o)}e.ok?(a=b.composeXHRErrorData(_,r[0],{status:e.status},{send:n,load:null,total:n}),N(h,a,o)):(a=b.composeXHRErrorData(y,r[0],{status:e.status},{send:n,load:null,total:n}),N(h,a,o))}else;}),n}}if(U.optimisedForSPA&&U.useHistory&&e.history){var A=e.history.pushState;e.history.pushState=function(){var r=[].slice.call(arguments);A.apply(e.history,r),G(),B()};var H=e.history.replaceState;e.history.replaceState=function(){var r=[].slice.call(arguments);H.apply(e.history,r),G(),B()}}function M(e){if(!e.message)return!0;var r=b.composeScriptErrorData(f,e.message,e.filename,e.lineno,e.colno,e.error);b.checkCrossOrigin(e.filename,U.exclude)&&U.behaviour&c&&N(f,r)}function F(e){var r=e.target.tagName,t=e.target.src||e.target.href;if(!(b.checkCrossOrigin(t,U.exclude)&&U.behaviour&u&&t))return!0;if("load"===e.type){var n=b.getResourceTimingData(t);if(b.checkCrossOrigin(t,U.origin)){var o=b.composeResourceErrorData(d,r,t);N(p,o,n)}n&&(o=b.composeResourceErrorData(v,r,t),N(p,o,n))}else"error"===e.type&&(o=b.composeResourceErrorData(g,r,t),N(p,o))}function X(e){var r=e.target;if(!(b.checkCrossOrigin(r.tracker._request_url,U.exclude)&&U.behaviour&l))return!0;if("readystatechange"===e.type){var t=["_time_init","_time_open","_time_send","_time_load","_time_done"];if(t[r.readyState]&&(r.tracker[t[r.readyState]]=b.getTime()),4===r.readyState){r.tracker._status=r.status;var n=b.calculateTrackerTiming(r.tracker),o=b.getResourceTimingData(r.tracker._request_url);if(b.checkCrossOrigin(r.tracker._request_url,U.origin)){var a=b.composeXHRErrorData(S,r.tracker._request_url,{status:r.tracker._status},n);N(h,a,o)}(n.send||n.load||n.total||r.tracker._status)&&(a=r.tracker._status>=200&&r.tracker._status<300?b.composeXHRErrorData(_,r.tracker._request_url,{status:r.tracker._status},n):b.composeXHRErrorData(y,r.tracker._request_url,{status:r.tracker._status},n),N(h,a,o))}}else"error"===e.type?(r.tracker._status=r.status,a=b.composeXHRErrorData(y,r.tracker._request_url,{status:r.tracker._status},n),N(h,a)):"timeout"===e.type&&(r.tracker._status=r.status,a=b.composeXHRErrorData(D,r.tracker._request_url,{status:r.tracker._status},n),N(h,a))}function G(r){if(e.performance&&e.performance.timing&&U.behaviour&m){var t={};t.dns=e.performance.timing.domainLookupEnd-e.performance.timing.domainLookupStart,t.connect=e.performance.timing.connectEnd-e.performance.timing.connectStart,t.request=e.performance.timing.responseStart-e.performance.timing.requestStart,t.response=e.performance.timing.responseEnd-e.performance.timing.responseStart,t.dom=e.performance.timing.domInteractive-e.performance.timing.domLoading,t.domContent=e.performance.timing.domComplete-e.performance.timing.domInteractive,t.load=e.performance.timing.domComplete-e.performance.timing.domainLookupStart,t.view=(new Date).getTime()-z,t.dns=t.dns<0?null:t.dns,t.connect=t.connect<0?null:t.connect,t.request=t.request<0?null:t.request,t.response=t.response<0?null:t.response,t.dom=t.dom<0?null:t.dom,t.domContent=t.domContent<0?null:t.domContent,t.load=t.load<0?null:t.load,t.view=t.view<0?null:t.view;var n=b.composePerformaceData(E,t);N(E,n)}}function B(r){if(e.performance&&e.performance.timing&&U.behaviour&m){var t={};t.dns=e.performance.timing.domainLookupEnd-e.performance.timing.domainLookupStart,t.connect=e.performance.timing.connectEnd-e.performance.timing.connectStart,t.request=e.performance.timing.responseStart-e.performance.timing.requestStart,t.response=e.performance.timing.responseEnd-e.performance.timing.responseStart,t.dom=e.performance.timing.domInteractive-e.performance.timing.domLoading,t.domContent=e.performance.timing.domComplete-e.performance.timing.domInteractive,t.load=e.performance.timing.domComplete-e.performance.timing.domainLookupStart,t.dns=t.dns<0?null:t.dns,t.connect=t.connect<0?null:t.connect,t.request=t.request<0?null:t.request,t.response=t.response<0?null:t.response,t.dom=t.dom<0?null:t.dom,t.domContent=t.domContent<0?null:t.domContent,t.load=t.load<0?null:t.load,$.length&&(J=b.getGUID()),$.push(e.location.href),z=z?(new Date).getTime():e.performance.timing.domComplete,ae=b.composePerformaceData(E,t),N(E,ae),Z.dispatchEvent({type:"enterpage",url:b.getCurrentURL(),referer:b.getRefererURL(),route:b.getRoute(b.getCurrentURL(),U.routeMapping),refererRoute:b.getRoute(b.getRefererURL(),U.routeMapping)})}}function V(e){G(),B()}if(e.performance&&e.performance.timing&&e.performance.timing.navigationStart)var J=b.getGUID(e.performance.timing.navigationStart);else J=b.getGUID();var $=[],z=null;function N(e,r,t,n){var o=!1,i=b.composeTrackerData(e,r);if(i.currentURL=b.getCurrentURL(),i.refererURL=b.getRefererURL(),i.currentRoute=b.getRoute(i.currentURL,U.routeMapping),i.refererRoute=b.getRoute(i.refererURL,U.routeMapping),i.viewPort=b.getViewPortSize(),i.userAgent=b.getUserAgent(),i.clientID=b.getClientID(),i.sessionID=b.getSessionID(),e===E?(i.messageID=J,o=!0):i.messageID=b.getGUID(n),i.token=U.token,i.version=a,i.userData=U.userData,t)for(var s in i.data.detail=i.data.detail||{},t)i.data.detail[s]=t[s];setTimeout(function(){Q(i,o)},0)}var K=[],W=null;function Q(r,t){if(r&&K.push(r),t&&K.length){var o=new e.XMLHttpRequest;o.open("POST",n,!0),o.send(e.JSON.stringify(K)),K=[],e.clearTimeout(W),Y()}}function Y(){W=e.setTimeout(function(){Q(null,!0),Y()},i)}Y(),e.addEventListener("beforeunload",G,!0),e.addEventListener("load",B,!0),e.addEventListener("error",M,!0),r.addEventListener("error",F,!0),r.addEventListener("load",F,!0),U.optimisedForSPA&&U.useHistory?e.addEventListener("popstate",V,!0):U.optimisedForSPA&&e.addEventListener("hashchange",V,!0);var Z=function(r){var t=[];function n(e){return e.message||(e=new Error(e)),e.error=e,e.filename=e.filename?e.filename:"",e.filename+=" via frontJS try - catch API",e.lineno=e.lineno?e.lineno:0,e.colno=e.colno?e.colno:0,M(e),null}return{try:function(){var e=arguments[0],r=arguments[1];try{return e.apply(r,[].slice.call(arguments,2))}catch(e){return n(e)}},catch:n,addEventListener:function(e,r){t[e]=t[e]?t[e]:[];for(var n=0;n<t[e].length;n++)if(r===t[e])return r;return t[e].push(r),r},removeEventListener:function(e,r){t[e]=t[e]?t[e]:[];for(var n=[],o=0;o<t[e].length;o++)r!==t[e][o]&&n.push(t[e][o]);return t[e]=n,r},dispatchEvent:function(r){var n=r.type;if("string"==typeof n){t[n]=t[n]?t[n]:[];for(var o=0;o<t[n].length;o++)"function"==typeof t[n][o]&&e.setTimeout(function(e){return function(){t[n][e](r)}}(o),0)}},composedTry:function(e,r){return function(){try{return e.apply(r,[].slice.call(arguments))}catch(e){return n(e)}}},addUserData:function(e,t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t||null===t?(r.userData[e]=t,!0):(R(1005,e),!1)},removeUserData:function(e){return delete r.userData[e],!0}}}(U),ee=e.performance&&e.performance.getEntriesByType&&e.performance.getEntriesByType("resource");if(ee&&ee.length){var re=e.performance.timing.navigationStart;J=b.getGUID(re);for(var te=0;te<ee.length;te++){var ne=b.getTimingData(ee[te]),oe=ee[te].name;if(ee[te].initiatorType&&["xmlhttprequest","fetch"].indexOf(ee[te].initiatorType.toLowerCase())>-1){if(!(b.checkCrossOrigin(oe,U.exclude)&&U.behaviour&l))continue;if(b.checkCrossOrigin(oe,U.origin)){var ae=b.composeXHRErrorData(S,oe,{status:200},{send:ne.request,load:ne.response,total:ne.request+ne.response});N(h,ae,ne,Math.floor(re+ee[te].startTime))}ae=b.composeXHRErrorData(_,oe,{status:200},{send:ne.request,load:ne.response,total:ne.request+ne.response}),N(h,ae,ne,Math.floor(re+ee[te].startTime))}else if(!(["navigation"].indexOf(ee[te].initiatorType.toLowerCase())>-1)){if(!(b.checkCrossOrigin(oe,U.exclude)&&U.behaviour&u&&oe))continue;b.checkCrossOrigin(oe,U.origin)&&(ae=b.composeResourceErrorData(d,ee[te].initiatorType.toUpperCase(),oe),N(p,ae,ne,Math.floor(re+ee[te].startTime))),ae=b.composeResourceErrorData(v,ee[te].initiatorType.toUpperCase(),oe),N(p,ae,ne,Math.floor(re+ee[te].startTime))}}s=ee.length}if(e.frontjsTmpData&&(e.frontjsTmpData.length||0===e.frontjsTmpData.length))var ie={r:e.frontjsTmpData,e:[],l:[]};else ie=e.frontjsTmpData||{r:[],e:[],l:[]};for(te=0;te<ie.r.length;te++){var se=ie.r[te][1]&&ie.r[te][1].target;ae=b.composeResourceErrorData(g,se.tagName,se.src||se.href),N(p,ae,null,ie.r[te][0])}for(te=0;te<ie.e.length;te++){var ce=ie.e[te][1];ae=b.composeScriptErrorData(f,ce.message,ce.filename,ce.lineno,ce.colno,ce.error),b.checkCrossOrigin(ce.filename,U.exclude)&&U.behaviour&c&&N(f,ae,null,ie.e[te][0])}if("complete"===r.readyState&&B(),ie.l&&ie.l.length)for(var ue=0;ue<ie.l.length;ue++)Z.addEventListener(ie.l[ue][0],ie.l[ue][1]);return e.document.removeEventListener("error",e.frontjsTmpCollector,!0),e.removeEventListener("error",e.frontjsTmpCollector,!0),delete e.frontjsTmpData,delete e.frontjsTmpCollector,{C:{SCRIPT:c,RESOURCE:u,XHR:l,PERFOMACE:m},V:a,try:Z.try,catch:Z.catch,addEventListener:Z.addEventListener,removeEventListener:Z.removeEventListener,composedTry:Z.composedTry,addUserData:Z.addUserData,removeUserData:Z.removeUserData}}(window,document,window.frontjsConfig);
//# sourceMappingURL=tracker.min.js.map